<form id="edit-product-form" class="grid grid-cols-1 md:grid-cols-2 gap-4" 
      hx-put="/api/admin/products/{{.Product.ID}}"
      hx-target='[data-product-id="{{.Product.ID}}"]'
      hx-swap="outerHTML"
      hx-indicator="#edit-loading"
      enctype="multipart/form-data">
  <input type="hidden" name="id" value="{{.Product.ID}}">
  <input type="hidden" name="current_image" value="{{.Product.Image}}">

  <div>
    <label for="edit-name" class="block text-sm font-medium text-gray-700 mb-2">Nome do Produto</label>
    <input 
      type="text" 
      id="edit-name" 
      name="name" 
        value="{{.Product.Name}}"
      required
      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
    >
  </div>

  <div>
    <label for="edit-price" class="block text-sm font-medium text-gray-700 mb-2">Preço (R$)</label>
    <input 
      type="number" 
      id="edit-price" 
      name="price" 
        value="{{.Product.Price}}"
      step="0.01"
      required
      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
    >
  </div>

  <div>
    <label for="edit-category" class="block text-sm font-medium text-gray-700 mb-2">Categoria</label>
    <select 
      id="edit-category" 
      name="category"
      required
      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
    >
      <option value="bebedouros" {{if eq .Product.Category "bebedouros"}}selected{{end}}>Bebedouros</option>
      <option value="purificadores" {{if eq .Product.Category "purificadores"}}selected{{end}}>Purificadores</option>
      <option value="refis" {{if eq .Product.Category "refis"}}selected{{end}}>Refis</option>
      <option value="pecas" {{if eq .Product.Category "pecas"}}selected{{end}}>Peças</option>
    </select>
  </div>

  <div>
    <label for="edit-brand_ids" class="block text-sm font-medium text-gray-700 mb-2">Marcas</label>
    <select
      id="edit-brand_ids"
      name="brand_ids"
      multiple
      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
    >
      {{range .Brands}}
        <option value="{{.ID}}" {{if index $.BrandSelections .ID}}selected{{end}}>{{.Name}}</option>
      {{end}}
    </select>
    <p class="text-xs text-gray-500 mt-1">Use Ctrl/Cmd para selecionar mais de uma marca.</p>
  </div>

  <div>
    <label for="edit-fits_product_ids" class="block text-sm font-medium text-gray-700 mb-2">Compatível com</label>
    <select
      id="edit-fits_product_ids"
      name="fits_product_ids"
      multiple
      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
    >
      {{range .Products}}
        <option value="{{.ID}}" {{if index $.FitSelections .ID}}selected{{end}}>{{.Name}}</option>
      {{end}}
    </select>
    <p class="text-xs text-gray-500 mt-1">Aplicável apenas para Refis e Peças.</p>
  </div>

  <div>
    <label for="edit-image" class="block text-sm font-medium text-gray-700 mb-2">Imagem do Produto (opcional - deixe como está para manter o atual)</label>
    <input 
      type="file" 
      id="edit-image" 
      name="image"
      accept="image/*"
      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
    >
  </div>

  <div class="md:col-span-2">
    <label class="block text-sm font-medium text-gray-700 mb-2">Imagem Atual</label>
    <img src="{{.Product.Image}}" alt="Current product image" class="w-32 h-32 object-contain border border-gray-300 rounded mb-2">
    <div id="edit-image-preview" class="hidden">
      <label class="block text-sm font-medium text-gray-700 mb-2">Prévia Nova Imagem</label>
      <img id="edit-preview-img" src="" alt="Preview" class="w-32 h-32 object-contain border border-gray-300 rounded">
    </div>
  </div>

  <div class="md:col-span-2">
    <input
      type="checkbox"
      class="w-4 h-4 text-green-600 bg-gray-100 border-gray-300 rounded focus:ring-green-500"
      name="is_available"
      id="edit-is_available"
      {{if .Product.IsAvailable}}checked{{end}}
    />
    <label for="edit-is_available" class="ml-2 text-sm font-medium text-gray-700">Produto em Estoque</label>
  </div>

  <div class="md:col-span-2 flex items-center gap-4">
    <button 
      type="submit"
      class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-semibold shadow-md hover:shadow-lg"
    >
      Atualizar Produto
    </button>
    <div id="edit-loading" class="hidden htmx-indicator">
      <div class="flex items-center gap-2">
        <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"></div>
        <span class="text-blue-600">Atualizando...</span>
      </div>
    </div>
    <button 
      type="button"
      onclick="closeEditModal()"
      class="bg-gray-300 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-400 transition-colors font-semibold"
    >
      Cancelar
    </button>
  </div>
</form>

<div id="edit-message" class="mt-4 hidden"></div>
